{% extends 'base.html' %}
{% block title %}Your Appointments{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">ðŸ“… Your Appointments</h2>
 <form method="get">
        <input type="text" name="q" placeholder="Search..." value="{{ search_query|default:'' }}">
        <button type="submit">Search</button>
    </form>
  <div class="card shadow-lg border-0 rounded-3">
    <div class="card-body">
      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Doctor</th>
            <th>Patient</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr>

            <!-- Doctor name -->
            <td>{{ appointment.doctor.user.get_full_name|default:appointment.doctor.user.username }}</td>

            <!-- Patient name -->
            <td>{{ appointment.patient.user.get_full_name|default:appointment.patient.user.username }}</td>

            <!-- Date -->
            <td>{{ appointment.appointment_date }}</td>

            <!-- Time -->
            <td>{{ appointment.appointment_time }}</td>

            <!-- Status -->
            <td>
              {% if appointment.status == 'Pending' %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% elif appointment.status == 'Confirmed' %}
                <span class="badge bg-success">Confirmed</span>
              {% elif appointment.status == 'Cancelled' %}
                <span class="badge bg-danger">Cancelled</span>
              {% else %}
                <span class="badge bg-secondary">{{ appointment.status }}</span>
              {% endif %}
            </td>

            <!-- Actions -->
            <td>
              <a href="{% url 'appointment_detail' appointment.id %}" class="btn btn-sm btn-outline-info">View</a>
              <a href="{% url 'create_medical_record' appointment_id=appointment.id %}" class="btn btn-sm btn-primary">Create Medical Record</a>
            </td>

          </tr>

          {% empty %}
          <tr>
            <td colspan="5">
                        {% if search_query %}
                            No appointments found matching your search.
                        {% else %}
                            No appointments found.
                        {% endif %}
                    </td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
